<div id='page-wrapper'>
  <div class='row'>
    <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>
      <h1 class='page-header'>収容一覧</h1>


      <table class="table table-striped table-order table-condensed" id="table_order" width="100%">
        <thead>
          <tr>
            <th width="10%">契約番号</th>
            <th width="20%">顧客番号</th>
            <th width="10%">依頼先</th>
            <th width="15%">ステータス</th>
            <th width="10%">依頼日</th>
            <th width="10%">納期回答</th>
            <th width="10%">種別</th>
            <th width="10%">作成者</th>
            <th width="5%"></th>
          </tr>
        </thead>

        <tbody>
        <% @orders.reverse_each do |order| %>
          <tr data-href="<%= url_for(order) %>">
            <td height="50" valign="bottom"><%= order.contract_number %></td>
            <td>
              <small><%= order.customer_number %></small><br>
              <% if CustomerNumber.find_by(customer_num: order.customer_number) %>
                <small><%= CustomerNumber.find_by(customer_num: order.customer_number).name %></small>
              <% end %>
            </td>
            <td>
              <% order.destgroups.each do |group| %>
                <%= group.name %>
              <% end %>
            </td>
            <td>
              <% if order.status == '確認中' %>
                <i class="text-danger fa fa-search"><%= order.status %></i>
              <% elsif order.status == '作業中' %>
                <i class="text-warning fa fa-wrench"><%= order.status %></i>
              <% elsif order.status == '作業完了' %>
                <i class="text-success fa  fa-check-square"><%= order.status %></i>
              <% elsif order.status == '完了' %>
                <i class="text-primary fa fa-check"><%= order.status %></i>
              <% end %>
            </td>
            <td><%= order.created_at %></td>
            <td><%= order.delivery_date %></td>
            <% if order.category %>
              <td><%= order.category.name %></td>
            <% else %>
              <td></td>
            <% end %>
            <td>
              <%= order.user.username%>
              <% if order.user.avatar.url.present? %>
                <%= image_tag order.user.avatar.thumb.url %>
              <% end %>
            </td>
            <td><%= link_to "", order, :class => "fa fa-info fa-fw" %></td>
          </tr>
        <% end %>
        </tbody>
      </table>


      <%= link_to '収容依頼作成', new_order_path, :class => "btn btn-primary" %>

    </div>
  </div>
</div>
<script>
$(document).ready(function() {
   $('tr[data-href]').addClass('clickable').click(function(e) {
     if(!$(e.target).is('a')){
       window.location = $(e.target).closest('tr').data('href');
     };
   });
});
$(document).ready(function() {
   $('#table_order').DataTable({
     "order": [[ 4, "desc" ]],
     "stateSave": true,
     aoColumns:[
      null,
      null,
      null,
      null,
      null,
      null,
      null,
      null,
      { "bSearchable": false }
     ]
   });
});
</script>
